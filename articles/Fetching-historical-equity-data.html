<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fetching Historical Equity Data • rb3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fetching Historical Equity Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rb3</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/Getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-equity-data.html">Fetching Historical Equity Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-index-data.html">Analyzing B3 Index Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-future-rates.html">How to Compute Historical Rates from B3 Future Prices</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-yield-curve.html">Fetching B3 Yield Curves</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rb3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fetching Historical Equity Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rb3/blob/main/vignettes/Fetching-historical-equity-data.Rmd" class="external-link"><code>vignettes/Fetching-historical-equity-data.Rmd</code></a></small>
      <div class="d-none name"><code>Fetching-historical-equity-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The B3 (Brasil, Bolsa, Balcão) provides historical stock market data
through its COTAHIST files. These files contain valuable information
about stocks, ETFs, BDRs, UNITs, REITs (FIIs), FIAGROs, and FIDCs
trading on the Brazilian exchange. The <code>rb3</code> package
simplifies access to this data through the templates
<code>b3-cotahist-yearly</code> and <code>b3-cotahist-daily</code>,
which handle the downloading and processing of these files.</p>
<p>The COTAHIST files represent one of the most comprehensive sources of
historical market data in Brazil, with annual files available as far
back as 1986. However, due to Brazil’s monetary stabilization process in
1994 (Plano Real), it is generally recommended to use data from 1995
onwards.</p>
<p>It’s important to note that the prices in these files are not
adjusted for corporate actions, which means that for long-term
historical analysis of individual stocks, additional adjustments may be
necessary.</p>
<p>In this vignette, we’ll explore how to fetch, filter, and analyze
historical equity data using the <code>rb3</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rb3" class="external-link">rb3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fetching-historical-data">Fetching historical data<a class="anchor" aria-label="anchor" href="#fetching-historical-data"></a>
</h2>
<p>To access historical equity data, we need to download the COTAHIST
files and create the corresponding datasets. The <code>rb3</code>
package provides functions to seamlessly handle this process.</p>
<div class="section level3">
<h3 id="downloading-yearly-data">Downloading yearly data<a class="anchor" aria-label="anchor" href="#downloading-yearly-data"></a>
</h3>
<p>For comprehensive historical analysis, you can download yearly
COTAHIST files. This is ideal for long-term studies covering multiple
years.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data for multiple years (example: 2018 to 2024)</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-cotahist-yearly"</span>, year <span class="op">=</span> <span class="fl">2018</span><span class="op">:</span><span class="fl">2024</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="downloading-daily-data">Downloading daily data<a class="anchor" aria-label="anchor" href="#downloading-daily-data"></a>
</h3>
<p>For more recent analysis or when you need specific dates, you can
fetch daily data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data for specific dates</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-cotahist-daily"</span>, refdate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2024-01-02"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-the-datasets">Accessing the datasets<a class="anchor" aria-label="anchor" href="#accessing-the-datasets"></a>
</h3>
<p>After downloading the data, you can access it using the
<code><a href="../reference/cotahist_get.html">cotahist_get()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access yearly dataset</span></span>
<span><span class="va">ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cotahist_get.html">cotahist_get</a></span><span class="op">(</span><span class="st">"yearly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access daily dataset</span></span>
<span><span class="va">ch_daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cotahist_get.html">cotahist_get</a></span><span class="op">(</span><span class="st">"daily"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/cotahist_get.html">cotahist_get()</a></code> function returns a lazy query that
doesn’t immediately load the data into memory. This approach allows
efficient manipulation of large datasets. To materialize the data as an
R tibble, use the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="filtering-by-asset-type">Filtering by asset type<a class="anchor" aria-label="anchor" href="#filtering-by-asset-type"></a>
</h2>
<p>The COTAHIST files contain data for various types of assets. The
<code>rb3</code> package provides specialized filter functions to
extract specific asset classes:</p>
<div class="section level3">
<h3 id="equities">Equities<a class="anchor" aria-label="anchor" href="#equities"></a>
</h3>
<p>For stocks trading on B3:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for stocks from 2024</span></span>
<span><span class="va">eq</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2024</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/cotahist-extracts.html">cotahist_filter_equity</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="etfs-exchange-traded-funds">ETFs (Exchange Traded Funds)<a class="anchor" aria-label="anchor" href="#etfs-exchange-traded-funds"></a>
</h3>
<p>For ETFs listed on B3:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for ETFs from 2024</span></span>
<span><span class="va">etfs</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2024</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/cotahist-extracts.html">cotahist_filter_etf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reits-fiis---fundos-imobiliários">REITs (FIIs - Fundos Imobiliários)<a class="anchor" aria-label="anchor" href="#reits-fiis---fundos-imobili%C3%A1rios"></a>
</h3>
<p>For real estate investment funds:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for REITs from 2024</span></span>
<span><span class="va">fii</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2024</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/cotahist-extracts.html">cotahist_filter_fii</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bdrs-brazilian-depositary-receipts">BDRs (Brazilian Depositary Receipts)<a class="anchor" aria-label="anchor" href="#bdrs-brazilian-depositary-receipts"></a>
</h3>
<p>For Brazilian depositary receipts of international companies:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for BDRs</span></span>
<span><span class="va">bdrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cotahist_get.html">cotahist_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/cotahist-extracts.html">cotahist_filter_bdr</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-asset-classes">Other asset classes<a class="anchor" aria-label="anchor" href="#other-asset-classes"></a>
</h3>
<p>Additional filter functions are available for other asset types:</p>
<ul>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_unit()</a></code>: For UNITs (sets of securities
traded as a single unit)</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_fidc()</a></code>: For FIDCs (Credit Rights
Investment Funds)</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_fiagro()</a></code>: For FIAGROs (Agribusiness
Investment Funds)</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_index()</a></code>: For market indices</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_equity_options()</a></code>: For stock
options</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_index_options()</a></code>: For index options</li>
<li>
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_fund_options()</a></code>: For fund options</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-equity-data">Analyzing equity data<a class="anchor" aria-label="anchor" href="#analyzing-equity-data"></a>
</h2>
<p>Let’s explore some common analyses you might perform with this
historical data.</p>
<div class="section level3">
<h3 id="top-traded-equities-by-volume">Top traded equities by volume<a class="anchor" aria-label="anchor" href="#top-traded-equities-by-volume"></a>
</h3>
<p>This example identifies the most actively traded stocks and
visualizes their monthly trading volumes:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get top 10 stocks by volume</span></span>
<span><span class="va">symbols_eq</span> <span class="op">&lt;-</span> <span class="va">eq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">symbol</span>, as_vector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate monthly volumes for top stocks</span></span>
<span><span class="va">eq_monthly</span> <span class="op">&lt;-</span> <span class="va">eq</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">symbol</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">symbols_eq</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">refdate</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-equity-data_files/figure-html/equity-volume-plot-1.png" alt="Monthly Trading Volume for Top 10 Brazilian Stocks" width="100%"><p class="caption">
Monthly Trading Volume for Top 10 Brazilian Stocks
</p>
</div>
</div>
<div class="section level3">
<h3 id="etf-market-share-analysis">ETF market share analysis<a class="anchor" aria-label="anchor" href="#etf-market-share-analysis"></a>
</h3>
<p>The market share of different ETFs provides insights into investor
preferences:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate total ETF volume</span></span>
<span><span class="va">total_volume</span> <span class="op">&lt;-</span> <span class="va">etfs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">volume</span>, as_vector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get volume share for top ETFs</span></span>
<span><span class="va">etf_shares</span> <span class="op">&lt;-</span> <span class="va">etfs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>volume_ratio <span class="op">=</span> <span class="va">volume</span> <span class="op">/</span> <span class="va">total_volume</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_max</a></span><span class="op">(</span><span class="va">volume_ratio</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>volume_ratio_acc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">volume_ratio</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-equity-data_files/figure-html/etf-share-plot-1.png" alt="Volume Share of Top 10 ETFs" width="100%"><p class="caption">
Volume Share of Top 10 ETFs
</p>
</div>
</div>
<div class="section level3">
<h3 id="analyzing-distribution-ids-for-price-continuity">Analyzing distribution IDs for price continuity<a class="anchor" aria-label="anchor" href="#analyzing-distribution-ids-for-price-continuity"></a>
</h3>
<p>The <code>distribution_id</code> field helps identify changes in a
stock’s pricing series, which might be due to corporate actions:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select a specific stock</span></span>
<span><span class="va">symbol_</span> <span class="op">&lt;-</span> <span class="st">"ITUB4"</span></span>
<span></span>
<span><span class="co"># Extract data for the selected stock</span></span>
<span><span class="va">stock_data</span> <span class="op">&lt;-</span> <span class="va">equities</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">symbol</span> <span class="op">==</span> <span class="va">symbol_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-equity-data_files/figure-html/distribution-id-plot-1.png" alt="Distribution ID Changes for ITUB4" width="100%"><p class="caption">
Distribution ID Changes for ITUB4
</p>
</div>
<div class="figure">
<img src="Fetching-historical-equity-data_files/figure-html/price-by-distribution-plot-1.png" alt="Price History for ITUB4 by Distribution ID" width="100%"><p class="caption">
Price History for ITUB4 by Distribution ID
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-bdrs">Working with BDRs<a class="anchor" aria-label="anchor" href="#working-with-bdrs"></a>
</h2>
<p>Brazilian Depositary Receipts (BDRs) represent shares of companies
listed on foreign exchanges:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the most common BDRs in the dataset</span></span>
<span><span class="va">top_bdrs</span> <span class="op">&lt;-</span> <span class="va">bdrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze trading volume for a specific BDR</span></span>
<span><span class="va">bdr_data</span> <span class="op">&lt;-</span> <span class="va">bdrs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">symbol</span> <span class="op">==</span> <span class="st">"AAPL34"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-equity-data_files/figure-html/bdr-volume-plot-1.png" alt="Trading Volume for AAPL34 (Apple BDR)" width="100%"><p class="caption">
Trading Volume for AAPL34 (Apple BDR)
</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we’ve explored how to fetch and analyze historical
equity data from B3 using the <code>rb3</code> package. The package
provides efficient tools for downloading COTAHIST files and extracting
specific asset classes through specialized filter functions.</p>
<p>The key steps in working with historical equity data include:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Downloading data</strong> using
<code><a href="../reference/fetch_marketdata.html">fetch_marketdata()</a></code> with either the
<code>b3-cotahist-yearly</code> or <code>b3-cotahist-daily</code>
templates</li>
<li>
<strong>Accessing datasets</strong> with
<code><a href="../reference/cotahist_get.html">cotahist_get()</a></code>
</li>
<li>
<strong>Filtering by asset type</strong> using specialized functions
like <code><a href="../reference/cotahist-extracts.html">cotahist_filter_equity()</a></code>,
<code><a href="../reference/cotahist-extracts.html">cotahist_filter_etf()</a></code>, etc.</li>
<li>
<strong>Analyzing the data</strong> using standard R data
manipulation and visualization tools</li>
</ol>
<p>This workflow enables a wide range of analyses, from studying trading
volumes and market shares to tracking price movements and identifying
corporate actions through distribution IDs.</p>
<p>For more advanced analyses, you might consider:</p>
<ul>
<li>Adjusting prices for corporate actions</li>
<li>Building portfolios and calculating returns</li>
<li>Analyzing liquidity patterns</li>
<li>Studying sector performance</li>
<li>Constructing custom indices</li>
</ul>
<p>The combination of B3’s comprehensive historical data and the
<code>rb3</code> package’s user-friendly interface provides a powerful
toolkit for researching and analyzing the Brazilian equity market.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Wilson Freitas, Marcelo Perlin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
