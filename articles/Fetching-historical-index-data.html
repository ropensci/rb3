<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyzing B3 Index Data • rb3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing B3 Index Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rb3</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/Getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-equity-data.html">Fetching Historical Equity Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-index-data.html">Analyzing B3 Index Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-future-rates.html">How to Compute Historical Rates from B3 Future Prices</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-yield-curve.html">Fetching B3 Yield Curves</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rb3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analyzing B3 Index Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rb3/blob/main/vignettes/Fetching-historical-index-data.Rmd" class="external-link"><code>vignettes/Fetching-historical-index-data.Rmd</code></a></small>
      <div class="d-none name"><code>Fetching-historical-index-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The B3 (Brasil, Bolsa, Balcão) provides comprehensive data for its
market indices through various endpoints. These indices represent
essential benchmarks for the Brazilian financial market, measuring the
performance of different market segments.</p>
<p>The <code>rb3</code> package simplifies access to this data through
four key templates:</p>
<ul>
<li>
<code>b3-indexes-historical-data</code>: Historical performance data
for B3 indices</li>
<li>
<code>b3-indexes-composition</code>: Composition of all B3 indices
showing which stocks belong to each index</li>
<li>
<code>b3-indexes-theoretical-portfolio</code>: Theoretical portfolio
weights for indices with detailed component weights</li>
<li>
<code>b3-indexes-current-portfolio</code>: Current actual portfolio
with additional sector classification information</li>
</ul>
<p>This vignette demonstrates how to retrieve, analyze, and visualize
index data using the <code>rb3</code> package, featuring examples for
the most popular indices like Ibovespa (IBOV), Small Caps (SMLL), and
Dividend Index (IDIV).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rb3" class="external-link">rb3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieving-available-indices">Retrieving available indices<a class="anchor" aria-label="anchor" href="#retrieving-available-indices"></a>
</h2>
<p>The <code>rb3</code> package provides a function to retrieve all
available indices from B3:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all available indices</span></span>
<span><span class="va">indexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes_get.html">indexes_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">indexes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "AGFS" "BDRX" "GPTW" "IBBR" "IBEE" "IBEP"</span></span></code></pre>
<p>These codes represent the various indices calculated and published by
B3. Some of the most important ones include:</p>
<ul>
<li>
<strong>IBOV</strong>: Ibovespa - the main Brazilian stock market
index</li>
<li>
<strong>SMLL</strong>: Small Caps Index - represents smaller market
capitalization stocks</li>
<li>
<strong>IDIV</strong>: Dividend Index - tracks stocks with the best
dividend payment policy</li>
<li>
<strong>IBXX</strong>: IBrX-100 - represents the 100 most traded
stocks</li>
<li>
<strong>IBXL</strong>: IBrX-50 - represents the 50 most traded
stocks</li>
<li>
<strong>IBRA</strong>: Brazil Broad-Based Index - broader market
index</li>
</ul>
</div>
<div class="section level2">
<h2 id="fetching-historical-index-data">Fetching historical index data<a class="anchor" aria-label="anchor" href="#fetching-historical-index-data"></a>
</h2>
<p>To analyze the historical performance of indices, you can use the
<code>b3-indexes-historical-data</code> template:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download historical data for specific indices across multiple years</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-indexes-historical-data"</span>,</span>
<span>  throttle <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2018</span><span class="op">:</span><span class="fl">2023</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After downloading, you can retrieve and analyze the data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the historical data for analysis</span></span>
<span><span class="va">index_history</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes_historical_data_get.html">indexes_historical_data_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">symbol</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span>,</span>
<span>    <span class="va">refdate</span> <span class="op">&gt;=</span> <span class="st">"2018-01-01"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="visualizing-index-performance">Visualizing index performance<a class="anchor" aria-label="anchor" href="#visualizing-index-performance"></a>
</h3>
<p>Let’s compare the performance of multiple indices over time:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the normalized performance (setting the starting point to 100)</span></span>
<span><span class="va">index_performance</span> <span class="op">&lt;-</span> <span class="va">index_history</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    norm_value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the performance chart</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">index_performance</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">refdate</span>, y <span class="op">=</span> <span class="va">norm_value</span>, color <span class="op">=</span> <span class="va">symbol</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparative Performance of B3 Indices"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Normalized values (starting at 100)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Normalized Value"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Index"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b %Y"</span>, date_breaks <span class="op">=</span> <span class="st">"6 months"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/plot-performance-1.png" alt="Historical Performance of B3 Indices (2018-2023)" width="100%"><p class="caption">
Historical Performance of B3 Indices (2018-2023)
</p>
</div>
<p>This chart shows the relative performance of the selected indices,
allowing you to compare their movements regardless of their absolute
values.</p>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-index-composition">Analyzing index composition<a class="anchor" aria-label="anchor" href="#analyzing-index-composition"></a>
</h2>
<p>The <code>b3-indexes-composition</code> template provides data about
which stocks belong to each index:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download index composition data</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-indexes-composition"</span><span class="op">)</span></span></code></pre></div>
<p>After downloading, you can retrieve the composition data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the composition data</span></span>
<span><span class="va">composition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes_composition_get.html">indexes_composition_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display a subset of the composition data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">composition</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   update_date symbol indexes                                     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2025-04-14  TTEN3  AGFS,IBRA,ICO2,ICON,IGCT,IGCX,IGNM,ITAG,SMLL</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2025-04-14  ABBV34 BDRX                                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2025-04-14  ABCB4  IBRA,ICO2,IDIV,IFNC,IGCT,IGCX,ITAG,SMLL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2025-04-14  ADBE34 BDRX                                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2025-04-14  A1AP34 BDRX                                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2025-04-14  A1MD34 BDRX</span></span></code></pre></div>
<div class="section level3">
<h3 id="finding-stocks-in-multiple-indices">Finding stocks in multiple indices<a class="anchor" aria-label="anchor" href="#finding-stocks-in-multiple-indices"></a>
</h3>
<p>You can analyze which stocks appear in multiple key indices:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get stocks in specific indices</span></span>
<span><span class="va">selected_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find stocks in each index</span></span>
<span><span class="va">stocks_by_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">selected_indices</span>, <span class="kw">function</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">composition</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">update_date</span> <span class="op">==</span> <span class="va">latest_date</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">indexes</span>, <span class="va">idx</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">selected_indices</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data frame for the Venn diagram visualization</span></span>
<span><span class="va">index_overlaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"IBOV only"</span>, <span class="st">"SMLL only"</span>, <span class="st">"IDIV only"</span>,</span>
<span>    <span class="st">"IBOV &amp; SMLL"</span>, <span class="st">"IBOV &amp; IDIV"</span>, <span class="st">"SMLL &amp; IDIV"</span>,</span>
<span>    <span class="st">"All three indices"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">stocks_by_index</span><span class="op">$</span><span class="va">SMLL</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IBOV</span><span class="op">)</span>, <span class="va">stocks_by_index</span><span class="op">$</span><span class="va">IDIV</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">intersect</span>, <span class="va">stocks_by_index</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a bar chart to visualize overlaps</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">index_overlaps</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">Index</span>, <span class="va">Count</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">Count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Stock Overlap Between Major B3 Indices"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"As of"</span>, <span class="va">latest_date</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Number of Stocks"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">Count</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/stocks-intersection-1.png" alt="Overlapping Stocks Between Major B3 Indices" width="100%"><p class="caption">
Overlapping Stocks Between Major B3 Indices
</p>
</div>
</div>
<div class="section level3">
<h3 id="finding-which-indices-contain-a-specific-stock">Finding which indices contain a specific stock<a class="anchor" aria-label="anchor" href="#finding-which-indices-contain-a-specific-stock"></a>
</h3>
<p>You can also determine which indices include a specific stock:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find all indices that include a specific stock</span></span>
<span><span class="va">find_indices_for_stock</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">stock_symbol</span>, <span class="va">comp_data</span>, <span class="va">date</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">comp_data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">update_date</span> <span class="op">==</span> <span class="va">date</span>, <span class="va">symbol</span> <span class="op">==</span> <span class="va">stock_symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">indexes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="st">","</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Example: Find indices containing PETR4</span></span>
<span><span class="va">petr4_indices</span> <span class="op">&lt;-</span> <span class="fu">find_indices_for_stock</span><span class="op">(</span><span class="st">"PETR4"</span>, <span class="va">composition</span>, <span class="va">latest_date</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "IBBR" "IBEE" "IBEW" "IBLV" "IBOV" "IBRA" "IBSD" "IBXL" "IBXX" "IDIV"</span></span>
<span><span class="co">#&gt; [11] "IDVR" "IGCT" "IGCX" "ITAG" "MLCX"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-index-weights-with-the-theoretical-portfolio">Analyzing index weights with the theoretical portfolio<a class="anchor" aria-label="anchor" href="#analyzing-index-weights-with-the-theoretical-portfolio"></a>
</h2>
<p>The <code>b3-indexes-theoretical-portfolio</code> template provides
information about the weights of stocks in each index:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download theoretical portfolio data</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-indexes-theoretical-portfolio"</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After downloading, you can retrieve and analyze the portfolio
weights:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the theoretical portfolio data</span></span>
<span><span class="va">theoretical</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes-portfolio.html">indexes_theoretical_portfolio_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the latest date for each index</span></span>
<span><span class="va">latest_dates</span> <span class="op">&lt;-</span> <span class="va">theoretical</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>latest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="top-constituents-by-weight">Top constituents by weight<a class="anchor" aria-label="anchor" href="#top-constituents-by-weight"></a>
</h3>
<p>You can analyze the top constituents of an index by weight:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the top 10 constituents by weight for IBOV</span></span>
<span><span class="va">ibov_top10</span> <span class="op">&lt;-</span> <span class="va">theoretical</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="st">"IBOV"</span>, <span class="va">refdate</span> <span class="op">==</span> <span class="va">latest_dates</span><span class="op">$</span><span class="va">latest</span><span class="op">[</span><span class="va">latest_dates</span><span class="op">$</span><span class="va">index</span> <span class="op">==</span> <span class="st">"IBOV"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a bar chart of top constituents</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ibov_top10</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">weight</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, fill <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Top 10 Constituents by Weight in Ibovespa"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"As of"</span>, <span class="va">latest_dates</span><span class="op">$</span><span class="va">latest</span><span class="op">[</span><span class="va">latest_dates</span><span class="op">$</span><span class="va">index</span> <span class="op">==</span> <span class="st">"IBOV"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Weight (%)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">weight</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/top-constituents-1.png" alt="Top 10 Constituents by Weight in Ibovespa" width="100%"><p class="caption">
Top 10 Constituents by Weight in Ibovespa
</p>
</div>
</div>
<div class="section level3">
<h3 id="comparing-index-concentration">Comparing index concentration<a class="anchor" aria-label="anchor" href="#comparing-index-concentration"></a>
</h3>
<p>You can compare the concentration of different indices by analyzing
their weight distribution:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate cumulative weights for different indices</span></span>
<span><span class="va">concentration_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">latest</span> <span class="op">&lt;-</span> <span class="va">latest_dates</span><span class="op">$</span><span class="va">latest</span><span class="op">[</span><span class="va">latest_dates</span><span class="op">$</span><span class="va">index</span> <span class="op">==</span> <span class="va">idx</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">index_weights</span> <span class="op">&lt;-</span> <span class="va">theoretical</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="va">idx</span>, <span class="va">refdate</span> <span class="op">==</span> <span class="va">latest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">total_stocks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">concentration_data</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    index <span class="op">=</span> <span class="va">idx</span>,</span>
<span>    top_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="va">total_stocks</span><span class="op">)</span>,</span>
<span>    cum_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index_weights</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">concentration_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">concentration_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a grouped bar chart</span></span>
<span><span class="va">concentration_plot</span> <span class="op">&lt;-</span> <span class="va">concentration_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">top_n</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>top_n_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Top"</span>, <span class="va">top_n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">concentration_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">cum_weight</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">top_n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Index Concentration Analysis"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Cumulative weight of top constituents"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative Weight"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Number of Stocks"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Top 1"</span>, <span class="st">"Top 5"</span>, <span class="st">"Top 10"</span>, <span class="st">"Top 20"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/index-concentration-1.png" alt="Weight Concentration in B3 Indices" width="100%"><p class="caption">
Weight Concentration in B3 Indices
</p>
</div>
<p>This chart shows how concentrated each index is, revealing
differences in their construction methodology.</p>
</div>
</div>
<div class="section level2">
<h2 id="sector-analysis-with-the-current-portfolio">Sector analysis with the current portfolio<a class="anchor" aria-label="anchor" href="#sector-analysis-with-the-current-portfolio"></a>
</h2>
<p>The <code>b3-indexes-current-portfolio</code> template provides the
actual current portfolio with additional sector classification:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download current portfolio data</span></span>
<span><span class="fu"><a href="../reference/fetch_marketdata.html">fetch_marketdata</a></span><span class="op">(</span><span class="st">"b3-indexes-current-portfolio"</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>After downloading, you can retrieve the data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the current portfolio data</span></span>
<span><span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes-portfolio.html">indexes_current_portfolio_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the latest date for each index</span></span>
<span><span class="va">current_latest</span> <span class="op">&lt;-</span> <span class="va">current</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>latest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sector-composition-analysis">Sector composition analysis<a class="anchor" aria-label="anchor" href="#sector-composition-analysis"></a>
</h3>
<p>You can analyze the sector composition of different indices:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create sector breakdown for each index</span></span>
<span><span class="va">sector_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IBOV"</span>, <span class="st">"SMLL"</span>, <span class="st">"IDIV"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">latest</span> <span class="op">&lt;-</span> <span class="va">current_latest</span><span class="op">$</span><span class="va">latest</span><span class="op">[</span><span class="va">current_latest</span><span class="op">$</span><span class="va">index</span> <span class="op">==</span> <span class="va">idx</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">sector_data</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">index</span> <span class="op">==</span> <span class="va">idx</span>, <span class="va">refdate</span> <span class="op">==</span> <span class="va">latest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sector</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">idx</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sector_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">sector_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a grouped bar chart for sector comparison</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sector_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">weight</span>, fill <span class="op">=</span> <span class="va">sector</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sector Composition of B3 Indices"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"As of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">current_latest</span><span class="op">$</span><span class="va">latest</span><span class="op">)</span>, <span class="st">"%b %Y"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Weight"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Sector"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.box <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/sector-composition-1.png" alt="Sector Breakdown of B3 Indices" width="100%"><p class="caption">
Sector Breakdown of B3 Indices
</p>
</div>
<p>This visualization shows how sector exposure varies across different
indices, which is important for diversification analysis.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-helper-functions-for-index-analysis">Creating helper functions for index analysis<a class="anchor" aria-label="anchor" href="#creating-helper-functions-for-index-analysis"></a>
</h2>
<p>You can create helper functions to streamline common tasks:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to get assets in specific indices</span></span>
<span><span class="va">indexes_assets_by_indexes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">index_list</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes_composition_get.html">indexes_composition_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>update_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">update_date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">update_date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">index_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/indexes_composition_get.html">indexes_composition_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">update_date</span> <span class="op">==</span> <span class="va">last_date</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">indexes</span>, <span class="va">idx</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">index_list</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Function to find which indices contain specific assets</span></span>
<span><span class="va">indexes_indexes_by_assets</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">last_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/indexes_composition_get.html">indexes_composition_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>update_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">update_date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">update_date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/indexes_composition_get.html">indexes_composition_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">update_date</span> <span class="op">==</span> <span class="va">last_date</span>, <span class="va">symbol</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">symbols</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">indexes</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      indexes_list <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">indexes</span>, <span class="st">","</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyzing-index-performance-metrics">Analyzing index performance metrics<a class="anchor" aria-label="anchor" href="#analyzing-index-performance-metrics"></a>
</h2>
<p>You can calculate various performance metrics for the indices:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate monthly returns</span></span>
<span><span class="va">monthly_returns</span> <span class="op">&lt;-</span> <span class="va">index_history</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    year_month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html" class="external-link">floor_date</a></span><span class="op">(</span><span class="va">refdate</span>, <span class="st">"month"</span><span class="op">)</span>,</span>
<span>    monthly_return <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">monthly_return</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">year_month</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    monthly_return <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last</a></span><span class="op">(</span><span class="va">monthly_return</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the monthly returns</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">monthly_returns</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year_month</span>, y <span class="op">=</span> <span class="va">monthly_return</span>, fill <span class="op">=</span> <span class="va">symbol</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">symbol</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Monthly Returns of B3 Indices"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Monthly Return"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="Fetching-historical-index-data_files/figure-html/performance-metrics-1.png" alt="Monthly Returns of B3 Indices" width="100%"><p class="caption">
Monthly Returns of B3 Indices
</p>
</div>
<div class="section level3">
<h3 id="calculating-summary-statistics">Calculating summary statistics<a class="anchor" aria-label="anchor" href="#calculating-summary-statistics"></a>
</h3>
<p>You can calculate summary statistics to compare the performance of
different indices:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate annualized summary statistics</span></span>
<span><span class="va">performance_summary</span> <span class="op">&lt;-</span> <span class="va">monthly_returns</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">monthly_return</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">monthly_return</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Std.Dev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">monthly_return</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">monthly_return</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">monthly_return</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Positive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">monthly_return</span> <span class="op">&gt;</span> <span class="fl">0</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Annualized.Return <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">Mean</span><span class="op">)</span><span class="op">^</span><span class="fl">12</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>    Annualized.Volatility <span class="op">=</span> <span class="va">Std.Dev</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>    Sharpe <span class="op">=</span> <span class="va">Annualized.Return</span> <span class="op">/</span> <span class="va">Annualized.Volatility</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the summary statistics</span></span>
<span><span class="va">performance_summary</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">Annualized.Return</span>, <span class="va">Annualized.Volatility</span>, <span class="va">Sharpe</span>, <span class="va">Positive</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Annualized.Return <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">Annualized.Return</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    Annualized.Volatility <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">Annualized.Volatility</span>, accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    Sharpe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Sharpe</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    Positive <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">Positive</span>, accuracy <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    Index <span class="op">=</span> <span class="va">symbol</span>,</span>
<span>    `Ann. Return` <span class="op">=</span> <span class="va">Annualized.Return</span>,</span>
<span>    `Ann. Volatility` <span class="op">=</span> <span class="va">Annualized.Volatility</span>,</span>
<span>    `Sharpe Ratio` <span class="op">=</span> <span class="va">Sharpe</span>,</span>
<span>    `% Positive Months` <span class="op">=</span> <span class="va">Positive</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   Index `Ann. Return` `Ann. Volatility` `Sharpe Ratio` `% Positive Months`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> IBOV  -3.54%        4.60%                      -<span style="color: #BB0000;">0.77</span> 41.7%              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> IDIV  -2.18%        4.01%                      -<span style="color: #BB0000;">0.55</span> 47.2%              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SMLL  -1.45%        5.17%                      -<span style="color: #BB0000;">0.28</span> 47.2%</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated how to work with B3 index data using the
<code>rb3</code> package. We covered:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Retrieving Available Indices</strong>: Using
<code><a href="../reference/indexes_get.html">indexes_get()</a></code> to list all available B3 indices.</li>
<li>
<strong>Historical Performance Analysis</strong>: Using
<code>b3-indexes-historical-data</code> to analyze and visualize index
performance over time.</li>
<li>
<strong>Index Composition Analysis</strong>: Using
<code>b3-indexes-composition</code> to understand which stocks belong to
each index.</li>
<li>
<strong>Portfolio Weight Analysis</strong>: Using
<code>b3-indexes-theoretical-portfolio</code> to analyze the weights and
concentration of indices.</li>
<li>
<strong>Sector Exposure Analysis</strong>: Using
<code>b3-indexes-current-portfolio</code> to analyze sector allocation
within indices.</li>
<li>
<strong>Performance Metrics</strong>: Calculating and comparing
performance statistics across different indices.</li>
</ol>
<p>The combination of these four templates provides a comprehensive
toolkit for analyzing the Brazilian equity market through its indices,
suitable for investors, researchers, and analysts.</p>
<p>For more advanced analyses, you might consider:</p>
<ul>
<li>Tracking changes in index composition over time</li>
<li>Building factor models using index constituents</li>
<li>Creating custom indices based on specific criteria</li>
<li>Analyzing the relationship between index performance and
macroeconomic variables</li>
<li>Constructing optimized portfolios based on index data</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Wilson Freitas, Marcelo Perlin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
