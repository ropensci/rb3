<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Enhanced Dataset Creation — superdataset • rb3</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Enhanced Dataset Creation — superdataset"><meta name="description" content="To maximize the utility of B3's existing datasets, several functions integrate data from multiple
sources to generate specialized datasets for specific analytical needs. For instance,
cotahist_equity_options_superset() combines data from COTAHIST datasets
(b3-cotahist-yearly, b3-cotahist-monthly, and b3-cotahist-daily) and Reference Rates
(b3-reference-rates) to construct a dataset containing stock options data. This dataset
includes details such as the closing price of the underlying stock, its ticker symbol, and the
applicable interest rate at option expiration. This comprehensive data enables users to perform
option pricing and calculate implied volatility."><meta property="og:description" content="To maximize the utility of B3's existing datasets, several functions integrate data from multiple
sources to generate specialized datasets for specific analytical needs. For instance,
cotahist_equity_options_superset() combines data from COTAHIST datasets
(b3-cotahist-yearly, b3-cotahist-monthly, and b3-cotahist-daily) and Reference Rates
(b3-reference-rates) to construct a dataset containing stock options data. This dataset
includes details such as the closing price of the underlying stock, its ticker symbol, and the
applicable interest rate at option expiration. This comprehensive data enables users to perform
option pricing and calculate implied volatility."><meta property="og:image" content="https://ropensci.github.io/rb3/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rb3</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/Getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-equity-data.html">Fetching Historical Equity Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-index-data.html">Analyzing B3 Index Data</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-future-rates.html">How to Compute Historical Rates from B3 Future Prices</a></li>
    <li><a class="dropdown-item" href="../articles/Fetching-historical-yield-curve.html">Fetching B3 Yield Curves</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/rb3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Enhanced Dataset Creation</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rb3/blob/main/R/scraper-cotahist.R" class="external-link"><code>R/scraper-cotahist.R</code></a>, <a href="https://github.com/ropensci/rb3/blob/main/R/scraper-yc.R" class="external-link"><code>R/scraper-yc.R</code></a></small>
      <div class="d-none name"><code>superdataset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>To maximize the utility of B3's existing datasets, several functions integrate data from multiple
sources to generate specialized datasets for specific analytical needs. For instance,
<code>cotahist_equity_options_superset()</code> combines data from COTAHIST datasets
(<code>b3-cotahist-yearly</code>, <code>b3-cotahist-monthly</code>, and <code>b3-cotahist-daily</code>) and Reference Rates
(<code>b3-reference-rates</code>) to construct a dataset containing stock options data. This dataset
includes details such as the closing price of the underlying stock, its ticker symbol, and the
applicable interest rate at option expiration. This comprehensive data enables users to perform
option pricing and calculate implied volatility.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cotahist_options_by_symbols_get</span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">yc_brl_with_futures_get</span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">yc_usd_with_futures_get</span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">yc_ipca_with_futures_get</span><span class="op">(</span><span class="va">refdate</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-symbols">symbols<a class="anchor" aria-label="anchor" href="#arg-symbols"></a></dt>
<dd><p>list of symbols to extract market data from the COTAHIST dataset.</p></dd>


<dt id="arg-refdate">refdate<a class="anchor" aria-label="anchor" href="#arg-refdate"></a></dt>
<dd><p>A Date object specifying the reference date for which to retrieve data</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function <code>cotahist_options_by_symbol_superset()</code> return an object that inherits from a <code>arrow_dplyr_query</code>
since it tries to preserve the lazy evaluation and avoids collecting the data before its return.</p>
<p>The functions <code>yc_brl_with_futures_get()</code>, <code>yc_usd_with_futures_get()</code> and <code>yc_ipca_with_futures_get()</code> return
a <code>data.frame</code> containing the yield curve data merged with futures contract information.
The data is pre-collected (not lazy) and includes all columns from the respective yield curve
function plus a <code>symbol</code> column identifying the corresponding futures contract.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The functions <code>cotahist_equity_options_superset()</code>, <code>cotahist_funds_options_superset()</code>,
<code>cotahist_index_options_superset()</code>, and <code>cotahist_options_by_symbol_superset()</code> use
information from the COTAHIST datasets (<code>b3-cotahist-yearly</code>, <code>b3-cotahist-monthly</code>,
and <code>b3-cotahist-daily</code>) and Reference Rates (<code>b3-reference-rates</code>) and return a dataframe
containing stock option data, including the closing price of the underlying stocks, the ticker
of the underlying asset, and the interest rate at the option's expiration. The returned dataframe
contains the following columns: "refdate", "symbol", "type", "symbol_underlying",
"strike_price", "maturity_date", "r_252", "close", "close_underlying", "volume",
"trade_quantity", and "traded_contracts".</p>
<p><code>cotahist_options_by_symbol_superset()</code> returns the same dataset but filtered for the specified asset ticker.</p>
<p>Returned objects preserve lazy evaluation whenever possible and avoid being
collected until the last possible moment. Exceptions occur when operations
cannot be performed using Arrow's operators — in such cases, data will be
collected and <code>data.frame</code>s will be returned. Please refer to the documentation
to identify the situations where this behavior applies.</p>
<p>These functions retrieve yield curve data merged with corresponding futures contract information:</p><ul><li><p><code>yc_brl_with_futures_get()</code>: BRL nominal rates with DI1 futures contracts</p></li>
<li><p><code>yc_usd_with_futures_get()</code>: USD rates (Cupom Cambial) with DDI futures contracts</p></li>
<li><p><code>yc_ipca_with_futures_get()</code>: Real (inflation-indexed) rates with DAP futures contracts</p></li>
</ul><p>These functions combine data from B3 Reference Rates (<code>b3-reference-rates</code>) and
Futures Settlement Prices (<code>b3-futures-settlement-prices</code>) to create comprehensive yield curve datasets.
The resulting data highlights key vertices along the curve with their corresponding futures contracts,
providing insight into the term structure of interest rates.</p>
<p>Each function requires a specific reference date to prevent excessive memory usage and
ensure optimal performance.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bizdays/man/adjust.date.html" class="external-link">preceding</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"Brazil/ANBIMA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bova_options</span> <span class="op">&lt;-</span> <span class="fu">cotahist_options_by_symbols_get</span><span class="op">(</span><span class="st">"BOVA11"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">refdate</span> <span class="op">==</span> <span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">petr_options</span> <span class="op">&lt;-</span> <span class="fu">cotahist_options_by_symbols_get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PETR4"</span>, <span class="st">"PETR3"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">refdate</span> <span class="op">==</span> <span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Get data for the last business day</span></span></span>
<span class="r-in"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bizdays/man/adjust.date.html" class="external-link">preceding</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"Brazil/ANBIMA"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve BRL yield curve with DI1 futures</span></span></span>
<span class="r-in"><span><span class="va">brl_curve</span> <span class="op">&lt;-</span> <span class="fu">yc_brl_with_futures_get</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">brl_curve</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve USD yield curve with DDI futures</span></span></span>
<span class="r-in"><span><span class="va">usd_curve</span> <span class="op">&lt;-</span> <span class="fu">yc_usd_with_futures_get</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve inflation-indexed yield curve with DAP futures</span></span></span>
<span class="r-in"><span><span class="va">ipca_curve</span> <span class="op">&lt;-</span> <span class="fu">yc_ipca_with_futures_get</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Wilson Freitas, Marcelo Perlin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

